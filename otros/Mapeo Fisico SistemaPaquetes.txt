CREATE SCHEMA SistemaPaquetes;
USE SistemaPaquetes;

CREATE TABLE Destino (
  Id INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(50) NOT NULL,
  CuotaDestino FLOAT NOT NULL,
  CONSTRAINT PK_DESTINO 
    PRIMARY KEY (Id));
  
CREATE TABLE Ruta (
  Id INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(50) NOT NULL,
  Estado INT NOT NULL,
  Descripcion VARCHAR(250) NULL,
  IdDestino INT NOT NULL,
  CONSTRAINT PK_RUTA 
    PRIMARY KEY (Id),
  CONSTRAINT FK_RUTA_TO_DESTINO_ID
    FOREIGN KEY (IdDestino)
    REFERENCES Destino (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE Usuario (
  DPI VARCHAR(13) NOT NULL,
  Nombre VARCHAR(50) NOT NULL,
  NombreUsuario VARCHAR(50) NOT NULL,
  Tipo INT NOT NULL,
  Estado INT NOT NULL,
  Contrase√±a VARCHAR(30) NOT NULL,
  CONSTRAINT PK_USUARIO 
    PRIMARY KEY (DPI));
  
CREATE TABLE PuntoControl (
  Numero INT NOT NULL,
  IdRuta INT NOT NULL,
  Nombre VARCHAR(45) NOT NULL,
  LimitePaquetes INT NOT NULL,
  DPIOperador VARCHAR(13) NOT NULL,
  TarifaOperacion FLOAT NULL,
  TarifaOperacionGlobal FLOAT NOT NULL,
  CONSTRAINT PK_PUNTOCONTROL
    PRIMARY KEY (IdRuta, Numero),
  CONSTRAINT FK_PC_TO_USUARIO_DPI
    FOREIGN KEY (DPIOperador)
    REFERENCES Usuario (DPI)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PC_TO_RUTA_ID
    FOREIGN KEY (IdRuta)
    REFERENCES Ruta (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE Paquete (
  Id INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(45) NOT NULL,
  Descripcion VARCHAR(200) NULL,
  Peso FLOAT NOT NULL,
  EstadoRetiro INT NOT NULL,
  Priorizado INT NOT NULL,
  IdRuta INT NOT NULL,
  CONSTRAINT PK_PAQUETE
    PRIMARY KEY (Id),
  CONSTRAINT FK_PAQUETE_TO_RUTA_ID
    FOREIGN KEY (IdRuta)
    REFERENCES Ruta (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE Cliente (
  NIT VARCHAR(8) NOT NULL,
  Nombre VARCHAR(40) NOT NULL,
  Direccion VARCHAR(50) NULL,
  Telefono VARCHAR(9) NULL,
  CONSTRAINT PK_CLIENTE
    PRIMARY KEY (NIT));
  
CREATE TABLE IngresoPaquete (
  Id INT NOT NULL AUTO_INCREMENT,
  CodigoFactura INT NOT NULL,
  IdPaquete INT NOT NULL,
  NitCliente VARCHAR(8) NOT NULL,
  Fecha DATE NOT NULL,
  PrecioPriorizacion FLOAT NOT NULL,
  PrecioLibra FLOAT NOT NULL,
  CuotaDestino FLOAT NOT NULL,
  CostoPeso FLOAT NOT NULL,
  Total FLOAT NOT NULL,
  CONSTRAINT PK_INGRESOPAQUETE
    PRIMARY KEY (Id),
  CONSTRAINT FK_IP_TO_PAQUETE_ID
    FOREIGN KEY (IdPaquete)
    REFERENCES Paquete (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_IP_TO_CLIENTE_NIT
    FOREIGN KEY (NitCliente)
    REFERENCES Cliente (NIT)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE ProcesoPaquete (
  Id INT NOT NULL AUTO_INCREMENT,
  IdPaquete INT NOT NULL,
  NoPuntoControl INT NOT NULL,
  IdRutaPC INT NOT NULL,
  Horas FLOAT NOT NULL,
  TarifaOperacion FLOAT NOT NULL,
  Costo FLOAT NOT NULL,
  CONSTRAINT PK_PROCESOPAQUETE
    PRIMARY KEY (Id),
  CONSTRAINT FK_PP_TO_PAQUETE_ID
    FOREIGN KEY (IdPaquete)
    REFERENCES Paquete (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PP_TO_PUNTOCONTROL
    FOREIGN KEY (IdRutaPC, NoPuntoControl)
    REFERENCES PuntoControl (IdRuta, Numero)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE RetiroPaquete (
  Id INT NOT NULL AUTO_INCREMENT,
  Costo FLOAT NOT NULL,
  Ingreso FLOAT NOT NULL,
  Ganancia FLOAT NOT NULL,
  IdPaquete INT NOT NULL,
  NitCliente VARCHAR(8) NOT NULL,
  FechaEntrega DATE NOT NULL,
  CONSTRAINT PK_RETIROPAQUETE
    PRIMARY KEY (Id),
  CONSTRAINT FK_RP_TO_PAQUETE_ID
    FOREIGN KEY (IdPaquete)
    REFERENCES Paquete (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_RP_TO_CLIENTE_NIT
    FOREIGN KEY (NitCliente)
    REFERENCES Cliente (NIT)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE ColaPuntoControl (
  IdPaquete INT NOT NULL,
  NoPuntoControl INT NOT NULL,
  IdRutaPC INT NOT NULL,
  CONSTRAINT PK_COLAPC
    PRIMARY KEY (IdRutaPC, NoPuntoControl, IdPaquete),
  CONSTRAINT FK_COLAPC_TO_PAQUETE_ID
    FOREIGN KEY (IdPaquete)
    REFERENCES Paquete (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_COLAPC_TO_PUNTOCONTROL
    FOREIGN KEY (IdRutaPC, NoPuntoControl)
    REFERENCES PuntoControl (IdRuta, Numero)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE ColaBodega (
  IdPaquete INT NOT NULL,
  CONSTRAINT PK_COLABODEGA
    PRIMARY KEY (IdPaquete),
  CONSTRAINT FK_COLAB_TO_PAQUETE_ID
    FOREIGN KEY (IdPaquete)
    REFERENCES Paquete (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
    
CREATE TABLE PreciosGlobales (
  Id INT NOT NULL AUTO_INCREMENT,
  Nombre VARCHAR(45) NOT NULL,
  Valor FLOAT NOT NULL,
  CONSTRAINT PK_PRECIOSGLOBALES
    PRIMARY KEY (Id));
